name: Deploy static content to Pages

on:
  # å¯¾è±¡ãƒ–ãƒ©ãƒ³ãƒãƒ—ãƒƒã‚·ãƒ¥æ™‚ã«å®Ÿè¡Œã•ã‚Œã¾ã™
  push:
    branches: ['Pages'] # ğŸ‘ˆ ã‚ãªãŸã®ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒåã«åˆã‚ã›ã¦ãã ã•ã„ï¼ˆreact-todo ã®å ´åˆã¯ã“ã“ã‚’å¤‰æ›´ï¼‰

  # Actions ã‚¿ãƒ–ã‹ã‚‰æ‰‹å‹•ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™
  workflow_dispatch:

# GITHUB_TOKEN ã®ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’è¨­å®šã—ã€GitHub Pages ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¨±å¯ã—ã¾ã™
permissions:
  contents: read
  pages: write
  id-token: write

# 1 ã¤ã®åŒæ™‚ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’å¯èƒ½ã«ã™ã‚‹
concurrency:
  group: 'pages'
  cancel-in-progress: true

jobs:
  # ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã ã‘ãªã®ã§ã€å˜ä¸€ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¸ãƒ§ãƒ–
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # 1. pnpm ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
      - name: Install pnpm
        uses: pnpm/action-setup@v3
        with:
          version: 9

      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm' # 2. ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾è±¡ã‚’ pnpm ã«å¤‰æ›´

      # 3. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (npm ci ã®ä»£ã‚ã‚Š)
      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      # 4. ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã®å¤‰æ›´
      - name: Build
        run: pnpm build

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          # dist ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
          path: './dist'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4